# Guided Tour

This repo contains a moderate-fidelity simulation of the fuel system of a Cessna A-37 Dragonfly. Explore it live here: https://petekneller.github.io/a37-fuel-simulation/

What? Why?

Well because the fuel systems of aircraft, especially military aircraft, are interesting. They're not like cars, or small boats, wherein you have a single fuel tank from which the engine/s just draw fuel. Aircraft often have multiple fuel tanks. Those tanks often have fuel drawn from them at different times in order to maintain aircraft balance. And sometimes managing which tank/s are active is the job of the pilot and sometimes it's the job of the aircraft's computer system.

The [Cessna A-37](https://en.wikipedia.org/wiki/Cessna_A-37_Dragonfly) was a US Air Force jet trainer of the 1950s that later was beefed up and pressed into duty as a light combat aircraft in Vietnam and beyond. I find it interesting because it has a number of fuel tanks, some of which were drawn from automatically and some under the control of the pilot. Some years ago I stumbled across the flight manual [^fm] on the internet and more recently was re-reading it and decided it would be amusing to see what a simulation of the fuel system might look like. I've not done any research on this subject outside of reading the flight manual so where the manual was ambiguous I've made a guess (but I've tried to make it clear as to when I'm guessing and when the manual is authoritive).

This document is written in the form of a walkthrough or tour of the simulation. It should take about 10 minutes to read and learn enough about the aircraft and simulation to play about with it yourself.

Still reading? Great, let's get started...

First, turn on the battery switch (left click your mouse or tap your finger on the toggle to flip it to the other position). It'll look like this:

<img src="/doc_images/battery_on.png" width="50px">

With the batteries connected to the electrical bus you'll see the _boost pump_ begin to operate. This is an electrically-driven, low-pressure pump that sits within the fuselage fuel tank (displayed in the centre of your screen).

<img src="/doc_images/boost_pump_on.png" width="100px">

It's _not_ the primary driver of fuel from the tank to the engines - there are also pumps at the engines. The manual states that the boost pump helps to prevent high altitude engine surge and prime the engine pumps in the case that they run dry. The rotating symbol for the pump is sitting inside a box that has a blue background. In this simulation that colour represents fuel. You'll see there is a wide, vertical bar of that same colour just above the boost pump. That represents graphically the proportion of fuel left in the tank. Between the pump and the bar is a textual display of the mass of fuel (in pounds) in the tank. There is graphical and textual indicator for each independent fuel tank in the aircraft.

Back to that boost pump. It's sitting inside a fuel-coloured box to indicate that there is fuel in the tank to which it's connected and so is providing positive pressure. If the fuselage tank (the only one from which it draws) were to run dry then the background of the pump would turn white. This is the case for all the pumps and fuel lines in the simulation. In the case of the boost pump if it were to lose pressure you would also see the _boost pump warning light_ (<img src="/doc_images/boost_warning.png" width="75px">) come on in the annunciator panel shown in the lower left of the display. Let's see that. The textual indicator for the fuselage fuel tank - the one reading '514 lbs' - click or tap on it. You'll see the text label turn into an edit box, with the current fuel quantity displayed. Type "0" and then the enter or tab keys (if you've a keyboard) or tap somewhere else on the screen if you're on a tablet. You should see the fuselage tank empty, the boost pump run dry and the boost warning light come on. You'll also happen to see the _fuel level low warning light_ come on, but let's return to that shortly. You're looking for this...

<img src="/doc_images/fuselage_dry.png" width="60%">

You can interact the same way with any of the fuel tanks in the aircraft: click/tap on the text displaying the fuel level, adjust it and then enter/tab/tap away to change it. You can enter any value between 0 and the maximum capacity of said tank. Enter a value larger than the maximum capacity and it will be capped. Enter a negative number and the value will be taken as 0. Enter anything that's not a number and the simulation will ignore what you typed and stick with the existing level. Let's get rid of that boost warning light. Change the level in the fuselage tank so that it holds 100 pounds of fuel. You'll mostly see things return to how they were before you emptied the tank, except that the fuel level low warning light is still lit. The fuselage tank of the A-37 contains a float-type switch which, at different positions, turn on and off various pumps and warning lights. The fuel level low warning light is the first of these - we'll see the rest shortly. It's lit any time the level in the fuselage tank drops below 295 pounds (+/- 20 pounds). The fuselage tank is the only one from which fuel is drawn to feed the engines - the other tanks empty into the fuselage - so if the level drops that low then a problem has occurred feeding from the other tanks (potentially pilot error) or the other tanks are empty and the fuselage level is now critically low.

Right - let's get the engines turning. But before that you will want to top up the fuselage tank. I can never recall the capacity of any of the tanks so I use a little trick where I just type in a suitably large number (eg. 1000 pounds) and let the software cap the tank to its maximum capacity. Once you've done that grab the throttle handles in the bottom centre of the screen with the mouse or your finger and drag them upwards to advance the throttles. You'll see the animated engines come alive, the engine-driven fuel pumps spin, the dual fuel flow gauges (one above each engine) indicate the rate at which fuel is being burnt[^ff], and the fuel lines between fuselage tank and each engine change to fuel-colour (indicating the flow of fuel). Obviously in the real world there's an elaborate engine startup sequence but that's hardly necessary for our purposes.

<img src="/doc_images/engines_on.png" width="40%">

Now that the engines are running we've got about 40 seconds before the next interesting thing happens, so we'll speak quickly. As I explained previously the fuselage tank feeds the engines and the other tanks empty into the fuselage tank. In the default configuration of this simulation the wing tanks will be the next from which fuel will be drawn. How? Recall the float switch that sits in the fuselage tank. When the fuel level in the fuselage drops to 450 pounds (+/- 20) then a pair of electrically-driven _proportioner pumps_ are activated, which draw fuel from the wings. The wings themselves each contain one fuel tank, made up of 6 interlinked cells. Once the level in the fuselage tank rises to 500 pounds[^ft], then the pumps shut off.

Wait a few more seconds until the level in the fuselage tank drops far enough and you'll see what I mean.

In the default aircraft configuration this will continue - the wings regularly topping up the fuselage - until the wing and fuselage tanks are dry and the engines shut down. There are other fuel tanks in the A-37 but they require pilot input to use. To demonstrate this we'll first burn off a little more fuel from the wing tanks. This will take a while, even at full throttle, unless we speed things up a bit. See the buttons at the top-left of the display, the ones that look like they belong on a music or video player? <img src="/doc_images/sim_controls.png" width="50px"> Those govern the rate at which the simulation progresses relative to real time, the current value of which is shown to the right of the controls. The one that looks like a fast-forward button speeds up the simulation, a factor of 2 for each press, up to a maximum of 32x. The one that looks like a rewind button slows it back down, but only to real time - there's no slow-motion. And the one that looks like a play button resets the simulation to real time. Why don't you hit the fast-forward button a couple of times and bring the simulation up to 4x? This will make the fuel transfer process quicker and easier to appreciate. Once the fuel in the wing tanks dips to about 500 pounds bring the simulation back to 1x and we'll continue.

At the end of each wing of the A-37 is a large streamlined fuel tank - the _tip tanks_. These tanks aren't drawn from by the proportioner pumps. They feed into the wing tanks, from where the fuel is consumed in the manner we've already seen. The transfer from the tip tanks is not automatic but rather under pilot control. See the panel to the lower-right of the display? That's the _fuel panel_. The upper half contains switches that configure the fuel system of the aircraft and the lower half holds two fuel gauges. We'll speak about the role of those switches and gauges shortly but for now let's focus on the two top-left-most switches - marked 'tip tank'. It won't be obvious while in the default configuration but those are 3 position toggle switches. They probably look like buttons right now when they're in the middle position. When switched to the upper position (labelled 'on') an electrical transfer pump in the corresponding tank is engaged and fuel is transferred to the wing tank on the same side. Do that now - click or tap just above each of the switches to move it to the upper position. They should look like this:

<img src="/doc_images/tip_switches.png" width="30%">

You will see the fuel pumps in each tip tank engage, at which point the fuel level in the wing tanks will rise as the tips empty into them.

At this point in the tour you've seen all the fundamental aspects of the simulation and know how to interact with each of the different controls present. Feel free to go away and experiment on your own if you'd like or keep reading for a few more minutes and I'll show you the rest of the features.

Back to those tip tanks. You've got the pumps switched on and fuel transferring to the wing tanks, topping them up. Guess what happens when the wing tanks are full? Unlike the proportioner pumps feeding the fuel tank, there's no automatic switch to turn them off. Instead, they overflow! Look at the fuel line between each wingtip tank and wing. Can you see the very small, clear line just above it? Those are vents lines, allowing air in and out to maintain atmospheric pressure in the tanks, or allow fuel to overflow if the tanks are overfilled. In the A-37 the vents for the wing tanks lead into the tip tanks so if the tip fuel pumps are not switched off then the fuel will simply overflow the wing tanks, back into the tips and recirculate. Watch this happen in the simulation (you might want to speed things up). When the wing tanks overflow the vent lines will turn a blue-green, different from the colour of the rest of the fuel lines. In real life this doesn't seem to be a problem - at least the flight manual makes no mention of it. However the flight manual _does_ state that the tip fuel pumps should not be left on after the tip tanks themselves are empty. This apparently risks burning out the pumps.[^sp] How does the pilot know when the tip tanks are dry? There is no fuel gauge for the tip tanks, instead there is a pressure switch in the fuel line between tip and wing tank. Should a tip tank pump switch be set to the 'on' position but there be no pressure in the fuel line then a warning light will announce 'tip tank empty'. I'd encourage to you check this out yourself by either speeding up the simulation until the tip tanks are empty or manually changing the level to empty.

Let's now return to the fuel panel and address it in more detail. At the bottom are two guages, each with two indicator needles. The one on the right indicates the fuel quantity in the wing tanks, where a float-type transceiver measures the level. There's one needle for each wing.[^wg] The left-hand gauge shows the level in the fuselage tank and the total internal quantity. The narrow needle indicates the level in the fuselage, as measured by the same float that controls the fuel pumps. The wide needle indicates the sum of the fuselage and wing tanks - considered the _internal_ quantity. Notable is the lack of inclusion of the wingtip tanks in this amount.

All of the switches on the panel are implemented in this simulation aside from the one at upper-most right, marked 'normal' and 'gravity'. This switch is used in emergency operations and disengages the proportioner pumps, thereafter relying upon gravity to move fuel from the wing tanks to fuselage. The next item on the panel we'll consider is the _fuel selector switch_. This is a 3 position toggle switch that lives halfway up the left side of the panel and is marked 'seat tank', 'wing' and 'aux pylon tank'. It governs the source from which fuel is drawn into the fuselage tank. It's default position is 'wing' and we've explored how that works. Let's consider the other two options.

The A-37 can carry up to four underwing fuel tanks on its store pylons. Fuel from these is drawn into the fuselage in the same manner as from the wing tanks - by the proportioner pumps under the control of the switches on the float in the fuselage tank. This will occur whenever the fuel selector switch is in the 'aux pylon tank' postion. In the default state of this simulation you'll find the two inner tanks filled and the two outer empty. Feel free to fiddle with fuel levels in the tanks and see how that affects the fuel flow. There are no fuel measurement probes in the pylon tanks. Instead there is a further switch on the fuselage float that is triggered when the level drops below 375 pounds (+/- 20). Below this level a lamp marked 'pylon tanks empty' will light on the annunciator panel. Consider that the proportioner pumps are activated when the fuselage level drops below 450 pounds. I guess the logic is that if the pylons are selected and the level has reached 375 then there cannot be any fuel left in the pylons.

The last source of fuel in the A-37 is an optional _seat tank_. If the right-hand (co-pilot) seat is removed from the aircraft it can be replaced with a fuel tank.[^st] I haven't seen any references to this being used in real life. I imagine it was used on ferry flights only and not in combat. Fuel from this tank is drawn into the fuselage when the fuel selector switch is in the 'seat' position. Unlike the other tanks feeding into the fuselage this is not via the proportioner pumps. There is a dedicated electrical pump controlled by the selector switch. When in the 'seat' position, fuel is transferred to the fuselage tank. The flight manual isn't specific about it but I've made the assumption that in the case the fuselage tank is full the excess fuel will flow through a vent line back into the seat tank. The seat tank also does not have any fuel measurement devices and a 'seat tank empty' light is driven by a switch on the fuselage float with the same 375 pound threshold as the pylon tanks.

# Bonus: Gauge Testing and Fuel Dumping

When I first decided to build this simulation what you've seen so far is all I intended. However there are a couple more features of the aircraft that I decided at the very end needed to be implemented.

To the right of the fuel selector switch there's a black button marked 'test fuel gauge'. When this is depressed the fuel gauges are all commanded to read 0 pounds as an indication that they are in fact functioning (not frozen in place?). In the real aircraft you push and hold the button to test the gauges. I've implemented a momentary switch instead - click/tap the button and it will be depressed for a few seconds before returning to normal.

The flight manual states clearly that if at all possible the fuel in the tip tanks should be used or dumped before landing the aircraft. The landing gear on the A-37 is mounted in the wings, fairly close to the fuselage. I imagine the combination of a heavy fuel load and long lever arm between the landing gear and wing tip means there's a high likelihood of damaging the wing spars unless the landing is very gentle. The alternative to burning off the fuel in those tanks is _dumping_ it. Each wingtip tank has a valve that can be opened, emptying the fuel to the outside world.[^fd] These values are controlled by the same switches on the fuel panel that turn on the tip tank fuel pumps. Instead of moving those switches to the upper position moving them to the lower position, marked 'dump', opens the valves. Note that there's a catch to closing the dump valves. You can't just move the switch to the 'off' position. You actually have to move the switches through 'off' to 'on' momentarily before moving back to 'off'.

# References and Credits

The vast majority of information I've used in this simulation was found the in flight manual previously mentioned[^fm]. The pictorial representations of the fuel tanks, engines, instruments and switches was heavily inspired by those found in the manual. Determining the arrangement of the needles and numbers on the gauges, however, required starring at photos of the cockpit, zoomed-in as far as possible trying to make out the numbers on the gauges. In the end I found invaluable the clear photos I found in articles at Airpressman[^c1] and Jetphotos[^c2]. I also enjoyed _Tweet and the Dragonfly_ by Kev Darling[^kd] which served to backup some of the information found in the manual.


[^fm]: USAF Series A-37B Aircraft Flight Manual, T.O.1A-37B-1, 1971; do a quick google - there are many sources on the internet.
[^ff]: I'm unsure of the maximum fuel flow of the engines in the A-37. The flight manual contains performance charts with fuel flow for various cruise profiles but nothing that indicates the rates at maximum thrust. So I've taken the highest values from the cruise charts and added a little more.
[^ft]: The flight manual states the proportioners switch off at 520 +/- 20. Since I've simulated the fuselage at 514 pounds I've picked the lower end of that range, to make clear that the pump has switched off, rather than the tank simply overflowing.
[^sp]: I'd hazard a guess that the pumps are submerged in the tanks and so are cooled by the fuel around them. It's my understanding that this is fairly common in aircraft fuel systems to use the fuel as a heat sink. This then becomes a problem when the tank is empty.
[^wg]: I've not got any information regarding which needle indicates which tank so I've made an arbitrary decision for the simulation.
[^st]: The flight manual doesn't state the capacity of the seat tank so I've made an arbitrary guess of 30 US gallons (based on imagining what a 44 gallon drum would look like sitting in the cockpit and downsizing from there).
[^fd]: The flight manual states that at 'optimum dumping speed' - 135 knots - the tip tanks will empty in 2 minutes 20 seconds. I've used the flow rate this dictates as the rate of fuel dumping in this simulation.
[^kd]: Darling, K 2005, _Tweet and the Dragonfly_, Lulu.com, United States.
[^c1]: Nelowkin, W 2015, Jetphotos.com, viewed 22nd January 2022, <https://www.jetphotos.com/photo/8119846>
[^c2]: Calcagno, E 2015, _A-37B “Dragonfly” – Post Maintenance Fly Test_, Airpressman.com, viewed 22nd January 2022, <https://airpressman.com/a-37b-dragonfly-post-maintenance-fly-test/>

# Appendix: Fuel Capacities

Following is the capacities of each tank in the A-37 (excluding the seat tank, for which I do not have information). Capacities are presented in US gallons and pounds. Capacity in pounds is presented with the same assumptions made in the flight manual: 6.5 pounds per gallon of JP-4 at standard day conditions.

|                 | Useable fuel |        |
|-----------------|--------------|--------|
| Tank            | US Gallons   | Pounds |
| Fuselage        | 79           | 514    |
| Wing (each)     | 99.25        | 645    |
| Wing tip (each) | 90           | 585    |
| Pylon (each)    | 97.3         | 632    |
